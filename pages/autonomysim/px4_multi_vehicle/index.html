<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://github.com/nervosys/AutonomySim/pages/autonomysim/px4_multi_vehicle/" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Setting up multi-vehicle PX4 simulation - AutonomySim</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Setting up multi-vehicle PX4 simulation";
        var mkdocs_page_input_path = "pages\\autonomysim\\px4_multi_vehicle.md";
        var mkdocs_page_url = "/nervosys/AutonomySim/pages/autonomysim/px4_multi_vehicle/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> AutonomySim
        </a>
        <div class="version">
          master
        </div><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Home</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../README.md">Home</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../../CHANGELOG.md">Changelog</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Building AutonomySim</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../use_precompiled.md">Download Binaries</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../build_windows.md">Build on Windows</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../build_linux.md">Build on Linux</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../build_macos.md">Build on macOS</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../docker_ubuntu.md">Docker on Linux</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../azure.md">AutonomySim on Azure</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../unreal_custenv.md">Custom Unreal Environment</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../Unity.md">AutonomySim with Unity</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../custom_unity_environments.md">Custom Unity Environment</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../unity_api_support.md">Unity APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../build_faq.md">FAQ</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Using AutonomySim</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../apis.md">Core APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../image_apis.md">Image APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../apis_cpp.md">C++ APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../api_docs/html/index.html">API Reference Docs</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../dev_workflow.md">Development Workflow</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../settings.md">Settings</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../camera_views.md">Camera Views</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../using_car.md">Car Mode</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../remote_control.md">Remote Control</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../xbox_controller.md">XBox Controller</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../steering_wheel_installation.md">Steering Wheel</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../multi_vehicle.md">Multiple Vehicles</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Sensors</a>
    <ul>
                <li class="toctree-l2"><a class="" href="../../../sensors.md">Sensors</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../lidar.md">LIDAR</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../distance_sensor.md">Distance Sensor</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../InfraredCamera.md">Infrared Camera</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../AutonomySim_ros_pkgs.md">ROS: AutonomySim ROS Wrapper</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../AutonomySim_tutorial_pkgs.md">ROS: AutonomySim Tutorial Packages</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../gazebo_drone.md">Import Gazebo models</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../retexturing.md">Domain Randomization</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../meshes.md">Mesh Vertex Buffers</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../playback.md">Playing Logs</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../voxel_grid.md">Voxel Grid Generator</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../event_sim.md">Event camera</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Design</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../design.md">Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../code_structure.md">Code Structure</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../adding_new_apis.md">Adding new APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../modify_recording_data.md">Modifying Recording Data</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../coding_guidelines.md">Coding Guidelines</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../robot_controller.md">Flight Controller</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../simple_flight.md">Simple Flight</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../hello_drone.md">Hello Drone</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">External Flight Controllers</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">MavLink and PX4</a>
    <ul>
                <li class="toctree-l2"><a class="" href="../../../px4_setup.md">PX4 Setup for AutonomySim</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../px4_sitl.md">PX4 in SITL</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../px4_sitl_wsl2.md">PX4 SITL with WSL 2</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../px4_lockstep.md">PX4 Lockstep</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../px4_multi_vehicle.md">PX4 Multi-vehicle in SITL</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://youtu.be/1oY8Qu5maQQ">AutonomySim with Pixhawk</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://youtu.be/HNWdYrtw3f0">PX4 Setup with AutonomySim</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://www.youtube.com/watch?v=d_FyjKDWQfc&feature=youtu.be">Debugging Attitude Estimation</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://github.com/nervosys/AutonomySim/wiki/Intercepting-MavLink-messages">Intercepting MavLink Messages</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://github.com/nervosys/AutonomySim/wiki/Rapid-Descent-on-PX4-drones">Rapid Descent on PX4 Drones</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../px4_build.md">Building PX4</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../px4_logging.md">PX4/MavLink Logging</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../log_viewer.md">MavLink LogViewer</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../mavlinkcom.md">MavLinkCom</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../mavlinkcom_mocap.md">MavLink MoCap</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">ArduPilot</a>
    <ul>
                <li class="toctree-l2"><a class="" href="https://ardupilot.org/dev/docs/building-the-code.html">ArduPilot SITL Setup</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://ardupilot.org/dev/docs/sitl-with-AirSim.html">AutonomySim & ArduPilot</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Upgrading</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../unreal_upgrade.md">Upgrading Unreal</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../upgrade_apis.md">Upgrading APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../upgrade_settings.md">Upgrading Settings</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Contributed Tutorials</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../reinforcement_learning.md">Reinforcement Learning</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://www.youtube.com/watch?v=y09VbdQWvQY">Using Environments from Marketplace</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/simondlevy/AirSimTensorFlow">Simple Collision Avoidance</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://aka.ms/AutonomousDrivingCookbook">Autonomous Driving on Azure</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/nervosys/AutonomySim/wiki/hexacopter">Building Hexacopter</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/nervosys/AutonomySim/wiki/moveOnPath-demo">Moving on Path Demo</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../point_clouds.md">Building Point Clouds</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../drone_survey.md">Surveying Using Drone</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../orbit.md">Orbit Trajectory</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://youtu.be/Bp86WiLUC80">Importing a custom multirotor mesh</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../object_detection.md">Object Detection</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://youtu.be/ZonkdMcwXH4">AutonomySim with MAVROS and PX4</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Misc</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../custom_drone.md">AutonomySim on Real Drones</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../cmake_linux.md">Installing cmake on Linux</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../hard_drive.md">Tips for Busy HDD</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../pfm.md">pfm format</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../unreal_proj.md">Setting up Unreal Environment</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../unreal_blocks.md">Blocks Environment</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../who_is_using.md">Who is Using AutonomySim</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../working_with_plugin_contents.md">Working with UE Plugin Contents</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/nervosys/AutonomySim/wiki/technion">Formula Student Technion Self-drive</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Support</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../faq.md">FAQ</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../SUPPORT.md">Support</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../create_issue.md">Create Issue</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../CONTRIBUTING.md">Contribute</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">AutonomySim</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Setting up multi-vehicle PX4 simulation</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/nervosys/AutonomySim/edit/master/docs/pages/autonomysim/px4_multi_vehicle.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="setting-up-multi-vehicle-px4-simulation">Setting up multi-vehicle PX4 simulation<a class="headerlink" href="#setting-up-multi-vehicle-px4-simulation" title="Permanent link">#</a></h1>
<p>The <a href="../px4_sitl/">PX4 SITL stack</a> comes with a <code>sitl_multiple_run.sh</code> shell script that runs multiple instances of the PX4 binary. This would allow the SITL stack to listen to connections from multiple AutonomySim vehicles on multiple TCP ports starting from 4560.
However, the provided script does not let us view the PX4 console. If you want to run the instances manually while being able to view each instance's console (<strong>Recommended</strong>) see <a href="./#starting-sitl-instances-with-px4-console">this section</a> </p>
<h2 id="setting-up-multiple-instances-of-px4-software-in-loop">Setting up multiple instances of PX4 Software-in-Loop<a class="headerlink" href="#setting-up-multiple-instances-of-px4-software-in-loop" title="Permanent link">#</a></h2>
<p><strong>Note</strong>: you have to build PX4 with <code>make px4_sitl_default none_iris</code> as shown <a href="../px4_sitl/#setting-up-px4-software-in-loop">here</a> before trying to run multiple PX4 instances.</p>
<ol>
<li>
<p>From your bash (or Cygwin) terminal go to the PX4 Firmware directory and run the <code>sitl_multiple_run.sh</code> script while specifying the number of vehicles you need
    <div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>PX4-Autopilot
./Tools/sitl_multiple_run.sh<span class="w"> </span><span class="m">2</span><span class="w">    </span><span class="c1"># 2 here is the number of vehicles/instances </span>
</code></pre></div>
    This starts multiple instances that listen to TCP ports 4560 to 4560+i where 'i' is the number of vehicles/instances specified</p>
</li>
<li>
<p>You should get a confirmation message that says that old instances have been stopped and new instances have been started
    <div class="highlight"><pre><span></span><code>killing<span class="w"> </span>running<span class="w"> </span>instances
starting<span class="w"> </span>instance<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>/cygdrive/c/PX4/home/PX4/Firmware/build/px4_sitl_default/instance_0
starting<span class="w"> </span>instance<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>/cygdrive/c/PX4/home/PX4/Firmware/build/px4_sitl_default/instance_1
</code></pre></div></p>
</li>
<li>
<p>Now edit <a href="../settings/">AutonomySim settings</a> file to make sure you have matching TCP port settings for the set number of vehicles and to make sure that both vehicles do not spawn on the same point. For example, these settings would spawn two PX4Multirotors where one of them would try to connect to PX4 SITL at port <code>4560</code> and the other at port <code>4561</code>. It also makes sure the vehicles spawn at <code>0,1,0</code> and <code>0,-1,0</code> to avoid collision:
    <div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;SettingsVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.2</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;SimMode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Multirotor&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Vehicles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;Drone1&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;VehicleType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PX4Multirotor&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;UseSerial&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;UseTcp&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;TcpPort&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4560</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;ControlPortLocal&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">14540</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;ControlPortRemote&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">14580</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;X&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;Y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;Z&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;Drone2&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;VehicleType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PX4Multirotor&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;UseSerial&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;UseTcp&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;TcpPort&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4561</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;ControlPortLocal&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">14541</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;ControlPortRemote&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">14581</span><span class="p">,</span><span class="w">       </span>
<span class="w">            </span><span class="nt">&quot;X&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;Y&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;Z&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
</code></pre></div>
    You can add more than two vehicles but you will need to make sure you adjust the TCP port for each (ie: vehicle 3's port would be <code>4562</code> and so on..) and adjust the spawn point.</p>
</li>
<li>
<p>Now run your Unreal AutonomySim environment and it should connect to SITL PX4 via TCP. If you are running the instances with the <a href="./#Starting-sitl-instances-with-px4-console">PX4 console visible</a>, you should see a bunch of messages from each SITL PX4 window. Specifically, the following messages tell you that AutonomySim is connected properly and GPS fusion is stable:
    <div class="highlight"><pre><span></span><code>INFO<span class="w">  </span><span class="o">[</span>simulator<span class="o">]</span><span class="w"> </span>Simulator<span class="w"> </span>connected<span class="w"> </span>on<span class="w"> </span>UDP<span class="w"> </span>port<span class="w"> </span><span class="m">14560</span>
INFO<span class="w">  </span><span class="o">[</span>mavlink<span class="o">]</span><span class="w"> </span>partner<span class="w"> </span>IP:<span class="w"> </span><span class="m">127</span>.0.0.1
INFO<span class="w">  </span><span class="o">[</span>ecl/EKF<span class="o">]</span><span class="w"> </span>EKF<span class="w"> </span>GPS<span class="w"> </span>checks<span class="w"> </span>passed<span class="w"> </span><span class="o">(</span>WGS-84<span class="w"> </span>origin<span class="w"> </span><span class="nb">set</span><span class="o">)</span>
INFO<span class="w">  </span><span class="o">[</span>ecl/EKF<span class="o">]</span><span class="w"> </span>EKF<span class="w"> </span>commencing<span class="w"> </span>GPS<span class="w"> </span>fusion
</code></pre></div></p>
</li>
</ol>
<p>If you do not see these messages then check your port settings.</p>
<p>You should also be able to use QGroundControl with SITL mode. Make sure there is no Pixhawk hardware plugged in, otherwise QGroundControl will choose to use that instead.  Note that as we don't have a physical board, an RC cannot be connected directly to it. So the alternatives are either use XBox 360 Controller or connect your RC using USB (for example, in case of FrSky Taranis X9D Plus) or using trainer USB cable to your PC. This makes your RC look like a joystick. You will need to do extra set up in QGroundControl to use virtual joystick for RC control.  You do not need to do this unless you plan to fly a drone manually in AutonomySim.  Autonomous flight using the Python API does not require RC, see <a href="../px4_sitl/#No-Remote-Control"><code>No Remote Control</code></a>.</p>
<h2 id="starting-sitl-instances-with-px4-console">Starting SITL instances with PX4 console<a class="headerlink" href="#starting-sitl-instances-with-px4-console" title="Permanent link">#</a></h2>
<p>If you want to start your SITL instances while being able to view the PX4 console, you will need to run the shell scripts found <a href="https://github.com/nervosys/AutonomySim/tree/main/PX4Scripts">here</a> rather than <code>sitl_multiple_run.sh</code>.</p>
<p>Here is how you would do so:</p>
<p><strong>Note</strong>: This script also assumes PX4 is built with <code>make px4_sitl_default none_iris</code> as shown <a href="../px4_sitl/#setting-up-px4-software-in-loop">here</a> before trying to run multiple PX4 instances.</p>
<ol>
<li>From your bash (or Cygwin) terminal go to the PX4 directory and get the scripts (place them in a subdirectory called Scripts win the PX4 directory as shown)
    <div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>PX4
mkdir<span class="w"> </span>-p<span class="w"> </span>Scripts
<span class="nb">cd</span><span class="w"> </span>Scripts
wget<span class="w"> </span>https://github.com/nervosys/AutonomySim/raw/main/PX4Scripts/sitl_kill.sh
wget<span class="w"> </span>https://github.com/nervosys/AutonomySim/raw/main/PX4Scripts/run_AutonomySim_sitl.sh
</code></pre></div>
    <strong>Note</strong> the shell scripts expect the <code>Scripts</code> and <code>Firmware</code> directories to be within the same parent directory. Also, you may need to make the scripts executable by running <code>chmod +x sitl_kill.sh</code> and <code>chmod +x run_AutonomySim_sitl.sh</code>.</li>
<li>Run the <code>sitl_kill.sh</code> script to kill all active PX4 SITL instances 
    <div class="highlight"><pre><span></span><code>./sitl_kill.sh
</code></pre></div></li>
<li>
<p>Run the <code>run_AutonomySim_sitl.sh</code> script while specifying which instance you would like to run in the current terminal window (the first instance would be numbered 0)
    <div class="highlight"><pre><span></span><code>./run_AutonomySim_sitl.sh<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1"># first instance = 0</span>
</code></pre></div></p>
<p>You should see the PX4 instance starting and waiting for AutonomySim's connection as it would with a single instance.
<div class="highlight"><pre><span></span><code>______<span class="w">  </span>__<span class="w">   </span>__<span class="w">    </span>___
<span class="p">|</span><span class="w"> </span>___<span class="w"> </span><span class="se">\ \ \ </span>/<span class="w"> </span>/<span class="w">   </span>/<span class="w">   </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span><span class="p">|</span>_/<span class="w"> </span>/<span class="w">  </span><span class="se">\ </span>V<span class="w"> </span>/<span class="w">   </span>/<span class="w"> </span>/<span class="p">|</span><span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w">  </span>__/<span class="w">   </span>/<span class="w">   </span><span class="se">\ </span><span class="w"> </span>/<span class="w"> </span>/_<span class="p">|</span><span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span><span class="p">|</span><span class="w">     </span>/<span class="w"> </span>/^<span class="se">\ \ \_</span>__<span class="w">  </span><span class="p">|</span>
<span class="se">\_</span><span class="p">|</span><span class="w">     </span><span class="se">\/</span><span class="w">   </span><span class="se">\/</span><span class="w">     </span><span class="p">|</span>_/

px4<span class="w"> </span>starting.
INFO<span class="w">  </span><span class="o">[</span>px4<span class="o">]</span><span class="w"> </span>Calling<span class="w"> </span>startup<span class="w"> </span>script:<span class="w"> </span>/bin/sh<span class="w"> </span>/cygdrive/c/PX4/home/PX4/Firmware/etc/init.d-posix/rcS<span class="w"> </span><span class="m">0</span>
INFO<span class="w">  </span><span class="o">[</span>dataman<span class="o">]</span><span class="w"> </span>Unknown<span class="w"> </span>restart,<span class="w"> </span>data<span class="w"> </span>manager<span class="w"> </span>file<span class="w"> </span><span class="s1">&#39;./dataman&#39;</span><span class="w"> </span>size<span class="w"> </span>is<span class="w"> </span><span class="m">11798680</span><span class="w"> </span>bytes
INFO<span class="w">  </span><span class="o">[</span>simulator<span class="o">]</span><span class="w"> </span>Waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>simulator<span class="w"> </span>to<span class="w"> </span>connect<span class="w"> </span>on<span class="w"> </span>TCP<span class="w"> </span>port<span class="w"> </span><span class="m">4560</span>
</code></pre></div>
4. Open a new terminal and go to the Scripts directory and start the next instance
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>PX4
<span class="nb">cd</span><span class="w"> </span>Scripts
./run_AutonomySim_sitl.sh<span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="c1"># ,2,3,4,..,etc</span>
</code></pre></div>
5. Repeat step 4 for as many instances as you would like to start
6. Run your Unreal AutonomySim environment and it should connect to SITL PX4 via TCP (assuming your settings.json file has the right ports).</p>
</li>
</ol>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Copyright &copy; 2024 Nervosys, LLC</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/nervosys/AutonomySim" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
